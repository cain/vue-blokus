webpackJsonp([1],{"0epE":function(t,e){},ArmO:function(t,e){},EUmc:function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("7+uW"),i=o("zL8q"),r=o.n(i),c=(o("tvR6"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]});var a=o("VU/8")({name:"App"},c,!1,function(t){o("VZ7C")},null,null).exports,s=o("/ocq"),l=o("Dd8w"),u=o.n(l),d=o("//Fk"),m=o.n(d),f=o("mtWM"),p=o.n(f),v=o("QmSG"),h=o.n(v),k=function(t,e,o){return new m.a(function(n,i){p.a[t](v.API_URL+e,o).then(function(t){return n(t)}).catch(function(t){return i(u()({},t).response.data.message)})})},_="get",y="post",g=function(t){return k(_,"/room/join/"+t.roomId+(t.userId?"?userId="+t.userId:""))},I=function(t){return k(y,"/room/create",{roomName:t})},b=function(t){return k(_,"/room/getAll")},x=function(t,e){return window.localStorage.setItem(t,e)},w=o("wuJz"),R={data:function(){return{rooms:[]}},mounted:function(){this.getRooms()},methods:{fromAgo:function(t){return Object(w.distanceInWordsStrict)(t,new Date)},joinRoom:function(t){var e,o=this;g({roomId:t,userId:(e="userId",window.localStorage.getItem(e))}).then(function(t){x("userId",t.data.player._id),o.$message({type:"success",message:"You have joined a room"}),o.$router.push({path:"/room/"+t.data.room._id})}).catch(function(t){o.$message({type:"error",message:t})})},createRoom:function(t){var e=this;I(t).then(function(t){x("userId",t.data.userId),e.$router.push({path:"/room/"+t.data.room._id}),e.$message({type:"success",message:"You have created a room"})}).catch(function(t){e.$message({type:"error",message:t})})},getRooms:function(){var t=this;b().then(function(e){t.rooms=e.data.rooms}).catch(function(e){t.$message({type:"error",message:e})})},createRoomPrompt:function(){var t=this;this.$prompt("","Enter a room name",{confirmButtonText:"OK",center:!0,cancelButtonText:"Cancel"}).then(function(e){t.createRoom(e.value)})}}},B={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-row",[o("el-row",[o("el-col",{staticClass:"text-center",attrs:{span:24}},[o("div",{staticClass:"logo"},[o("img",{staticClass:"emoji",attrs:{draggable:"false",width:"20px",alt:"ðŸ…±",src:"https://twemoji.maxcdn.com/2/72x72/1f171.png"}})]),t._v(" "),o("h2",[t._v("\n        Blokus\n      ")])])],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:24}},[o("el-table",{staticStyle:{"max-width":"700px",margin:"auto"},attrs:{data:t.rooms}},[o("el-table-column",{attrs:{label:"Name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.name)+"\n          ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"Players"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("i",{staticClass:"el-icon-view"}),t._v("\n            "+t._s(e.row.players.length)+"/4 Players\n          ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"Last Update"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("i",{staticClass:"el-icon-time"}),t._v("\n            "+t._s(t.fromAgo(e.row.updatedAt))+" ago\n          ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:""},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"primary"},on:{click:function(o){t.joinRoom(e.row._id)}}},[t._v("Join")])]}}])})],1)],1)],1),t._v(" "),o("el-row",{staticClass:"text-center"},[o("el-col",{attrs:{span:24}},[o("p",[t._v("OR")]),t._v(" "),o("el-button",{attrs:{size:"mini"},on:{click:t.createRoomPrompt}},[t._v("Create Room")])],1),t._v(" "),o("el-col",{staticStyle:{"margin-top":"18px"},attrs:{span:24}},[o("small",{staticStyle:{color:"#606262","margin-top":"100px",width:"100%"}},[t._v("Made by "),o("a",{attrs:{target:"_blank",href:"https://github.com/cain"}},[t._v("cain")]),t._v(", source code "),o("a",{attrs:{target:"_blank",href:"https://github.com/cain/vue-blokus"}},[t._v("github")])])])],1),t._v(" "),o("el-footer",{staticClass:"text-center"})],1)},staticRenderFns:[]};var S=o("VU/8")(R,B,!1,function(t){o("0epE")},"data-v-13e2d6dc",null).exports,E=o("Gu7T"),C=o.n(E),G=o("Xxa5"),D=o.n(G),Z=o("exGp"),$=o.n(Z),A=o("oZBU"),P=o.n(A),T=o("hygk"),L=o.n(T),O={render:function(){var t,e=this,o=e.$createElement,n=e._self._c||o;return n("div",{staticClass:"block",class:(t={},t[e.team]=!0,t),style:e.blockPosition,on:{click:function(t){e.onClick(e.block)}}},[n("div",{staticClass:"helper",style:e.helperStyling}),e._v(" "),e._l(e.block.pieces,function(t){return n("div",{key:e.block.id+"x"+t.x+"y"+t.y,staticClass:"piece",style:{left:(t.x-1)*e.GRID_SIZE+"px",bottom:(t.y-1)*e.GRID_SIZE+"px"}})})],2)},staticRenderFns:[]};var U={name:"Board",props:["roomId"],components:{block:o("VU/8")({name:"block",props:["block","GRID_SIZE","onClick","team"],computed:{blockPosition:function(){return{top:this.block.y*this.GRID_SIZE+"px",left:this.block.x*this.GRID_SIZE+"px"}},helperStyling:function(){var t=this.block.grid,e=t.x,o=t.y;return{width:(e+2)*this.GRID_SIZE+"px",height:(o+2)*this.GRID_SIZE+"px",left:"-"+((e+2)*this.GRID_SIZE/2-e/2*this.GRID_SIZE)+"px",top:"-"+(o+1)*this.GRID_SIZE+"px"}}}},O,!1,function(t){o("EUmc")},null,null).exports},sockets:{connected:function(){console.log("socket connected")},blockMove:function(t){console.log("SOCKET SERVER BLOCK MOVE",t),this.moveBlock(t.block)},blockEdit:function(t){var e=this.blocks.find(function(e){return e._id===t.block._id});e.grid=t.block.grid,e.pieces=t.block.pieces}},data:function(){return{GRID_SIZE:h.a.GRID_SIZE,blocks:[],rows:Array.apply(null,Array(20)).map(function(t,e){return e}),cols:Array.apply(null,Array(20)).map(function(t,e){return e}),activeBlock:!1,player:{}}},mounted:function(){var t=this;this.joinRoom(),document.addEventListener("mousemove",function(){t.mouseController()},!1),document.addEventListener("keydown",function(e){!t.activeBlock||39!==e.keyCode&&37!==e.keyCode&&82!==e.keyCode?!t.activeBlock||38!==e.keyCode&&40!==e.keyCode&&70!==e.keyCode||(e.preventDefault(),console.log("flip"),t.flipBlock(t.activeBlock),t.$socket.emit("block_edit",{block:t.activeBlock,roomId:t.roomId,userId:window.localStorage.getItem("userId")})):(e.preventDefault(),console.log("rotate"),t.rotateBlock(t.activeBlock),t.$socket.emit("block_edit",{block:t.activeBlock,roomId:t.roomId,userId:window.localStorage.getItem("userId")}))})},methods:{mouseController:function(){var t=this;if(this.activeBlock){var e=this.mousePosition(),o=Math.round(e.x/h.a.GRID_SIZE),n=Math.round(e.y/h.a.GRID_SIZE),i=this.blocks.find(function(e){return e._id===t.activeBlock._id});if(o===i.x&&n===i.y)return;i.x=o,i.y=n,this.$socket.emit("block_move",{block:i,roomId:this.roomId,userId:window.localStorage.getItem("userId")})}},moveBlock:function(t){var e=this.blocks.find(function(e){return e._id===t._id});e.x===t.x&&e.y===t.y||(e.x=t.x,e.y=t.y)},mousePosition:function(){return event=event||window.event,null==event.pageX&&null!=event.clientX&&(e=(t=event.target&&event.target.ownerDocument||document).documentElement,o=t.body,event.pageX=event.clientX+(e&&e.scrollLeft||o&&o.scrollLeft||0)-(e&&e.clientLeft||o&&o.clientLeft||0),event.pageY=event.clientY+(e&&e.scrollTop||o&&o.scrollTop||0)-(e&&e.clientTop||o&&o.clientTop||0)),{x:event.pageX,y:event.pageY};var t,e,o},getActiveElement:function(){return this.$refs[this.activeBlock._id+this.activeBlock.team][0].$el},selectPiece:function(t){t._id===this.activeBlock._id?this.unselect():this.activeBlock||(this.activeBlock=t,this.$socket.emit("block_select",{block:t}))},getBlockGrid:function(t){return t=t.getBoundingClientRect(),{left:this.divideByGrid(t.left+window.scrollX),right:this.divideByGrid(t.right),bottom:this.divideByGrid(t.bottom),top:this.divideByGrid(t.top+window.scrollY)}},divideByGrid:function(t){return t/h.a.GRID_SIZE},unselect:function(){var t=this.findNearbyBlocks(this.activeBlock);this.isPlacementValid(this.activeBlock,t)?this.activeBlock=!1:this.$notify({title:"Warning",message:"You can't place blocks on-top of each other",type:"warning"})},joinRoom:function(){var t=this;g({roomId:this.roomId,userId:window.localStorage.getItem("userId")}).then(function(e){window.localStorage.setItem("userId",e.data.player._id),t.player={id:e.data.player._id,team:e.data.player.team},t.blocks=e.data.room.blocks})},leaveRoom:function(){var t=$()(D.a.mark(function t(){var e=this;return D.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$confirm("Are you sure you want to leave?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",center:!0}).then(function(){e.$router.push({path:"/"})});case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),findNearbyBlocks:function(t){var e=[t.x-1,t.y-1],o=[t.x+t.grid.x+1,t.y+t.grid.y+1];return this.blocks.filter(function(n){return n.x+n.grid.x+1>e[0]&&n.x-1<o[0]&&n.y+n.grid.y+1>e[1]&&n.y-1<o[1]&&n._id!==t._id})},isPlacementValid:function(t,e){var o=[],n=t.pieces.map(function(e){return{x:e.x+t.x,y:t.y-e.y+1}});return e.forEach(function(t){o.push.apply(o,C()(P()(n,t.pieces.map(function(e){return{x:e.x+t.x,y:t.y-e.y+1}}),L.a)))}),0===o.length},rotateBlock:function(t){var e=this.blocks.find(function(e){return e._id===t._id});e.pieces=e.pieces.map(function(t){return{x:t.y,y:-t.x+e.grid.x+1}}),e.grid={y:e.grid.x,x:e.grid.y}},flipBlock:function(t){var e=this.blocks.find(function(e){return e._id===t._id});e.pieces=e.pieces.map(function(t){return{x:-t.x+e.grid.x+1,y:t.y}})}},computed:{}},V={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"container",class:{active:!1!==t.activeBlock}},[o("div",{staticClass:"player-info"},[t._v("\n      Player ID: "+t._s(t.player.id)+" "),o("br"),t._v("\n      Team: "+t._s(t.player.team)+" "),o("br"),t._v(" "),o("button",{on:{click:function(e){t.leaveRoom()}}},[t._v("leave game")])]),t._v(" "),t.activeBlock?o("div",{staticClass:"click-overlay",on:{click:function(e){t.unselect()}}}):t._e(),t._v(" "),o("div",{staticClass:"board",style:{top:3*t.GRID_SIZE+"px",left:3*t.GRID_SIZE+"px"}},t._l(t.rows,function(e){return o("div",{key:e,staticClass:"row"},t._l(t.cols,function(t){return o("div",{key:t,staticClass:"grid"})}))})),t._v(" "),t._l(t.blocks,function(e){return o("block",{key:e._id+e.team,ref:e._id+e.team,refInFor:!0,attrs:{team:e.team,block:e,GRID_SIZE:t.GRID_SIZE,onClick:t.selectPiece}})})],2)])},staticRenderFns:[]};var j={components:{Board:o("VU/8")(U,V,!1,function(t){o("ArmO")},"data-v-6cc141ea",null).exports}},M={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("Board",{attrs:{roomId:this.$route.params.id}})],1)},staticRenderFns:[]};var F=o("VU/8")(j,M,!1,function(t){o("quqM")},null,null).exports;n.default.use(s.a);var X=new s.a({mode:"history",routes:[{path:"/",name:"lobby",component:S},{path:"/room/:id",name:"room",component:F}]}),Y=o("hMcO"),q=o.n(Y);n.default.config.productionTip=!1,n.default.use(q.a,h.a.SOCKET_URL),n.default.use(r.a),new n.default({el:"#app",router:X,components:{App:a},template:"<App/>"})},QmSG:function(t,e){t.exports={GRID_SIZE:20,API_URL:"http://blokusbackend.cainhall.com.au/v1/",SOCKET_URL:"http://blokusbackend.cainhall.com.au"}},VZ7C:function(t,e){},quqM:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.31d061c67978968541ad.js.map